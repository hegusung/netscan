import uuid
import json
import requests
from utils.config import Config

class VulnCallback:

    @classmethod
    def init(self):
        self.callbacks = {}

    @classmethod
    def register(self, vuln_info):
        vuln_uuid = str(uuid.uuid4())

        self.callbacks[vuln_uuid] = vuln_info

        print("New callback %s" % vuln_uuid)

        return vuln_uuid

    @classmethod
    def check(self, vuln_uuid):
        if vuln_uuid in self.callbacks:

            print("!!! %s !!!" % self.callbacks[vuln_uuid])

    @classmethod
    def new_vulnerability_check(self, vuln_info):
        srv_ip = Config.config.get("Server", "bind_ip")
        if srv_ip == "0.0.0.0":
            srv_ip = "127.0.0.1"
        srv_port = Config.config.get("Server", "http_port")

        res = requests.post("http://%s:%d/register_callback/", data=json.dumps(vuln_info)) 

        return res.text
